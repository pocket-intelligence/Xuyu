# 深度报告功能测试清单

## ✅ 功能测试

### 1. 快速报告模式（直接问答）
- [ ] 启动项目：`npm run start`
- [ ] 输入主题（如"人工智能的最新发展"）
- [ ] 审查研究细节，直接继续或修改
- [ ] 选择输出格式：**直接问答**
- [ ] 验证流程：
  - [ ] askDetails → userReviewDetails → buildQuery → userChooseFormat
  - [ ] search → extractContent → writeReport(快速) → END
- [ ] 检查报告：
  - [ ] 长度适中（~300字）
  - [ ] 回答简洁明了
  - [ ] 有基本的信息来源引用

### 2. 快速报告模式（结构化输出）
- [ ] 输入主题（如"区块链技术应用"）
- [ ] 选择输出格式：**结构化输出**
- [ ] 验证流程：同上
- [ ] 检查报告：
  - [ ] JSON 格式正确
  - [ ] 包含 title、summary、trends、recommendations
  - [ ] 数据结构完整

### 3. 深度报告模式
- [ ] 输入主题（如"量子计算的商业化前景"）
- [ ] 选择输出格式：**深度报告**
- [ ] 验证流程：
  - [ ] askDetails → userReviewDetails → buildQuery → userChooseFormat
  - [ ] search → extractContent → coarseRead → craftOutline → fillOutline → writeReport(增强) → END
- [ ] 检查报告：
  - [ ] 包含引言（2-4句）
  - [ ] 有清晰的章节结构（3-6个）
  - [ ] 每章有详细内容（多段落）
  - [ ] 段落末尾有【来源: XXX】标注
  - [ ] 包含"总结与建议"章节
  - [ ] 包含"参考来源"章节
  - [ ] Markdown 格式正确

## ✅ 数据库记录测试

### 4. 会话记录
- [ ] 打开"研究记录"页面
- [ ] 验证会话列表：
  - [ ] 显示研究主题
  - [ ] 显示输出格式（直接问答/深度报告/结构化输出）
  - [ ] 显示 Token 使用量
  - [ ] 显示状态（运行中/已完成/已失败）
  - [ ] 显示创建时间

### 5. 步骤日志
- [ ] 点击任意会话的"查看"按钮
- [ ] 验证步骤列表：
  - [ ] 快速报告：显示 askDetails, buildQuery, search, extractContent, writeReport
  - [ ] 深度报告：额外显示 coarseRead, craftOutline, fillOutline
  - [ ] 不显示 userReviewDetails, userChooseFormat（用户输入节点已过滤）
  - [ ] 每个步骤显示正确的图标和颜色
  - [ ] 显示执行时间和 Token 消耗

## ✅ 前端展示测试

### 6. 步骤进度显示
- [ ] 深度报告执行过程中：
  - [ ] 依次显示：💡研究要点分析 → 🔍搜索关键词生成 → 🌐搜索结果 → 📄页面内容抽取
  - [ ] 深度模式额外显示：👓粗读与主题抽取 → 📋生成报告大纲 → ✍️逐章填充内容 → 📝生成研究报告
- [ ] 当前执行步骤有高亮显示
- [ ] 已完成步骤显示绿色对勾

### 7. 用户输入交互
- [ ] userReviewDetails 节点：
  - [ ] 显示 LLM 生成的研究问题
  - [ ] 提供输入框供用户修改
  - [ ] 点击"继续"后流程继续
- [ ] userChooseFormat 节点：
  - [ ] 显示三个格式选项卡片
  - [ ] 点击后流程继续，且 output_format 正确设置

### 8. 搜索和抓取进度
- [ ] search 阶段：
  - [ ] 显示正在搜索的关键词
  - [ ] 显示当前进度（如 2/5）
  - [ ] 显示每个关键词的搜索结果数量
- [ ] extractContent 阶段：
  - [ ] 显示正在抓取的 URL
  - [ ] 显示抓取进度（如 3/5）
  - [ ] 显示每个页面的字数

## ✅ 错误处理测试

### 9. 网络错误
- [ ] 关闭 SearXNG 服务
- [ ] 执行搜索，验证：
  - [ ] 显示搜索失败提示
  - [ ] 不会崩溃，允许继续或重试

### 10. LLM API 错误
- [ ] 配置错误的 API 密钥
- [ ] 执行研究，验证：
  - [ ] 显示 LLM 调用失败提示
  - [ ] 步骤状态标记为"失败"
  - [ ] 会话状态标记为"failed"

### 11. 页面抓取错误
- [ ] 提供无效或无法访问的 URL
- [ ] 验证：
  - [ ] 跳过失败的 URL，继续抓取其他页面
  - [ ] 显示抓取失败提示
  - [ ] 使用成功抓取的页面继续流程

## ✅ 中断恢复测试

### 12. 用户输入中断
- [ ] 执行研究，在 userReviewDetails 停止
- [ ] 刷新页面或关闭应用
- [ ] 重新打开，验证：
  - [ ] 可以从中断点继续
  - [ ] 之前的输入和状态保留

### 13. 网络中断恢复
- [ ] 执行研究到一半时断网
- [ ] 恢复网络后继续
- [ ] 验证：
  - [ ] 可以从断点恢复
  - [ ] 已完成的步骤不重复执行

## ✅ 性能测试

### 14. Token 消耗统计
- [ ] 完成一次快速报告，记录 Token 消耗
  - [ ] 预期：~1500 tokens
- [ ] 完成一次深度报告，记录 Token 消耗
  - [ ] 预期：~4500+ tokens
- [ ] 验证会话详情中的 Token 统计准确

### 15. 执行时间测试
- [ ] 快速报告执行时间：
  - [ ] 预期：~45-60秒
- [ ] 深度报告执行时间：
  - [ ] 预期：~90-120秒
- [ ] 记录各阶段耗时，识别瓶颈

## ✅ 边界条件测试

### 16. 空输入
- [ ] 输入为空时点击开始
- [ ] 验证：显示"请输入研究主题"提示

### 17. 极长输入
- [ ] 输入超长主题（>1000字符）
- [ ] 验证：
  - [ ] 正常处理或截断
  - [ ] 不会导致 UI 崩溃

### 18. 特殊字符
- [ ] 输入包含特殊字符（如 `"'<>&`）
- [ ] 验证：
  - [ ] 正确转义，不导致注入
  - [ ] 正常生成报告

### 19. 无搜索结果
- [ ] 输入极其冷门的主题（如随机生成的字符串）
- [ ] 验证：
  - [ ] 显示无搜索结果提示
  - [ ] 或基于少量结果生成报告
  - [ ] 不会崩溃

## ✅ 代码质量检查

### 20. TypeScript 编译
- [ ] 运行 `npm run build`（如果有）
- [ ] 验证：无 TypeScript 编译错误

### 21. ESLint 检查
- [ ] 运行 ESLint（如果配置）
- [ ] 验证：无严重的 lint 错误

### 22. 控制台日志
- [ ] 打开浏览器控制台
- [ ] 执行完整流程
- [ ] 验证：
  - [ ] 无错误日志（除了预期的网络失败）
  - [ ] 日志信息清晰，有助于调试

## 📊 测试结果记录

| 测试项              | 状态 | 备注 | 测试人 | 日期 |
| ------------------- | ---- | ---- | ------ | ---- |
| 快速报告-直接问答   | ⏳    |      |        |      |
| 快速报告-结构化输出 | ⏳    |      |        |      |
| 深度报告            | ⏳    |      |        |      |
| 会话记录显示        | ⏳    |      |        |      |
| 步骤日志显示        | ⏳    |      |        |      |
| 用户输入交互        | ⏳    |      |        |      |
| 搜索抓取进度        | ⏳    |      |        |      |
| 网络错误处理        | ⏳    |      |        |      |
| LLM API 错误处理    | ⏳    |      |        |      |
| 中断恢复            | ⏳    |      |        |      |
| Token 统计          | ⏳    |      |        |      |
| 执行时间            | ⏳    |      |        |      |

**图例**：
- ⏳ 待测试
- ✅ 通过
- ❌ 失败
- ⚠️ 部分通过

## 🐛 已知问题记录

（在测试过程中发现的问题记录在此）

1. 

2. 

3. 

## 💡 改进建议

（测试过程中的改进想法记录在此）

1. 

2. 

3. 
